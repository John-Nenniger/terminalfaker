var bootMessageLines=["System loading...<br>",(new Date).toString()+"<br>","&nbsp;_______&nbsp;&nbsp;&nbsp;______&nbsp;<br>|__&nbsp;&nbsp;&nbsp;__|&nbsp;|&nbsp;&nbsp;____|<br>&nbsp;&nbsp;&nbsp;|&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;|__&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;|&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;__|&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;|&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;|_|&nbsp;&nbsp;&nbsp;&nbsp;|_|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>","Terminal Faker version "+version+"<br>","By Sherri Wheeler (SyntaxSeed.com)<br>","Ready. Type 'help' to get started.<br><br>"];var builtInCommands={};builtInCommands.cat={about:"cat [file]<br>&nbsp;&nbsp;Display the contents of the specified file.",exe:function(args){if(args.length!=2){return"No such file."}var result=term.catFile(args[1]);if(result===false){return"No such file, or argument is a directory."}result=(result+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+"<br>"+"$2");return result}};builtInCommands.cd={about:"cd [path]<br>&nbsp;&nbsp;Change directory to the specified path.",exe:function(args){if(args.length!=2){return""}var result=term.changeDirectory(args[1]);if(!result){return"No such directory."}return""}};builtInCommands.clear={about:"clear<br>&nbsp;&nbsp;Clear the terminal window.",exe:function(){return""}};builtInCommands.echo={about:"echo [string]&nbsp;display a line of text",exe:function(args){var result=args.slice();result.shift();return result.join(" ")}};builtInCommands.encrypt={about:"encrypt [message] [password]<br>&nbsp;&nbsp;Encrypt a provided message using the password.",exe:function(args){if(args.length!=3){return"encrypt: Invalid number of arguments."}var result=Tea.encrypt(args[1],args[2]);return result}};builtInCommands.decrypt={about:"decrypt [encoded] [password]<br>&nbsp;&nbsp;Decrypt a provided message using the password.",exe:function(args){if(args.length!=3){return"decrypt: Invalid number of arguments."}var result=Tea.decrypt(args[1],args[2]);return result}};builtInCommands.help={about:"help [command]<br>&nbsp;&nbsp;Show a list of available commands, or help for a specific command.",exe:function(args){var output="";if(args.length==2&&args[1]&&args[1].toLowerCase()in commands){output+="<strong>"+args[1].toLowerCase()+"</strong>: "+commands[args[1].toLowerCase()].about+""}else{output+="TERMFAKE bash, version "+version+"-release (x86_64-pc-linux-gnu)<br>These shell commands are defined internally.  Type 'help' to see this list.<br>Type 'help name' to find out more about the function 'name'.<br><br>";output+="";Object.keys(commands).sort().forEach(function(cName){if(!commands[cName].hidden){output+="<strong>"+cName+"</strong>&nbsp; "}})}output+="<br><br>";return output}};builtInCommands.history={about:"history [-c]<br>&nbsp;&nbsp;Display the list of recent commands.<br>&nbsp;&nbsp;-c clear the history list.",exe:function(args){if(args.length==2&&args[1]=="-c"){localStorage.setItem("history",[]);term.history=[]}var history=term.history;var output="";history.forEach(function(element,index){output+=index+"&nbsp;&nbsp;"+element+"<br>"});return output}};builtInCommands.ls={about:"ls [-l]<br>&nbsp;&nbsp;List directory contents.<br>&nbsp;&nbsp;-l list contents vertically.",exe:function(args){var listing="";var children=Array.prototype.slice.call(term.filesystemPointer.querySelector("c").children);children.forEach(function(element,index){listing+="<span class='filesystem-"+element.nodeName+"'>"+element.getAttribute("name")+"</span>";if(args[1]&&args[1]=="-l"){listing+="<br>"}else{listing+="&nbsp;&nbsp;"}});return listing}};builtInCommands.reboot={about:"reboot<br>&nbsp;&nbsp;Reboot the terminal and reset saved environment.",exe:function(){localStorage.removeItem("filesystem");localStorage.removeItem("history");term.initSession();term.bootTerminalStart(document.getElementById("terminal"));return""}};builtInCommands.rm={about:"rm [name]<br>&nbsp;&nbsp;Delete the file with the specified name in the current directory.",exe:function(args){if(args.length==1){return"No filename specified."}if(args.length>2){return"Too many parameters supplied."}var result=term.deleteFile(args[1]);if(result!==true){return result}return""}};builtInCommands.touch={about:"touch [name]<br>&nbsp;&nbsp;Create a file with the specified name in the current directory.",exe:function(args){if(args.length==1){return"No filename specified."}if(args.length>2){return"Too many parameters supplied."}var result=term.makeFile(args[1]);if(result!==true){return result}return""}};builtInCommands.version={about:"version<br>&nbsp;&nbsp;Display the version and attribution of this terminal application.",exe:function(){return"Terminal Faker: version "+version+" (https://github.com/syntaxseed/terminalfaker) by Sherri Wheeler."}};var version="1.4.0";function Path(){this.path="/";Path.prototype.isValidDirectory=function(filename){if(filename==""){return false}var newFilename=filename.replace(/[^A-Za-z\d\-_~]/,"");if(newFilename.length!=filename.length){return false}return true};Path.prototype.isValidFilename=function(filename){if(filename==""){return false}var newFilename=filename.replace(/[^A-Za-z\d\.\-_~]/,"");newFilename=newFilename.replace(/^\.|\.$/g,"");if(newFilename.length!=filename.length){return false}var foundPeriods=newFilename.match(/\./g);if(foundPeriods!=null&&foundPeriods.length>1){return false}return true};Path.prototype.isValidDirectoryPath=function(filename){if(filename==""){return false}var newFilename=filename.replace(/[^A-Za-z\d\/\-_~]/,"");newFilename=newFilename.replace(/(\/)\/+/g,"$1");if(newFilename.length!=filename.length){return false}return true};Path.prototype.getDirectoryPart=function(filepath,assumeDirectory){var dirs="";if(filepath==""){return false}if(assumeDirectory&&this.isValidDirectory(filepath)){dirs=filepath}else if(!assumeDirectory&&this.isValidFilename(filepath)){return false}else{dirs=filepath.substring(0,filepath.lastIndexOf("/"))}return dirs+"/"};Path.prototype.getFilenamePart=function(filepath,assumeFile){if(filepath==""){return false}if(assumeFile&&this.isValidFilename(filepath)){return filepath}else if(!assumeFile&&this.isValidDirectory(filepath)){return false}var name=filepath.split("\\").pop().split("/").pop();if(name==""){return false}return name};Path.prototype.parseDirPathToSelector=function(path){if(path=="/"||path=="~"){return"d[path='/'][name='/']"}path=path.replace(/\/+$/,"");var name=path.split("\\").pop().split("/").pop();var dirs=path.substring(0,path.lastIndexOf("/")+1);return"d[path='"+dirs+name+"/'][name='"+name+"']"};Path.prototype.parseFilePathToSelector=function(path){var name=path.split("\\").pop().split("/").pop();var dirs=path.substring(0,path.lastIndexOf("/")+1);return"f[path='"+dirs+"'][name='"+name+"']"}}var Terminal=function(){var self={};self.pathMgr=new Path;var KEY_UP=38,KEY_DOWN=40,KEY_TAB=9,MAX_HISTORY=20;var resetPrompt=function(terminal,prompt,clear){var newPrompt=prompt.parentNode.cloneNode(true);var promptsAll=document.querySelectorAll("[contenteditable=true]");for(var i=0;i<promptsAll.length;i++){promptsAll[i].setAttribute("contenteditable",false)}if(self.prompt){newPrompt.querySelector(".prompt").textContent=self.prompt}if(typeof clear!=="undefined"&&clear){while(terminal.firstChild)terminal.removeChild(terminal.firstChild)}terminal.appendChild(newPrompt);newPrompt.querySelector(".prompt").innerHTML=self.customPrompt();newPrompt.querySelector(".input").innerHTML=" ";newPrompt.querySelector(".input").focus()};var runCommand=function(terminal,cmd,args){terminal.innerHTML+="<div>"+self.commands[cmd].exe(args)+"</div>"};var updateHistory=function(cmd){if(self.history.length>=MAX_HISTORY){self.history.shift()}self.history.push(cmd);localStorage.setItem("history",self.history);self.historyIndex=self.history.length};var browseHistory=function(prompt,direction){var changedPrompt=false;if(direction==KEY_UP&&self.historyIndex>0){prompt.textContent=self.history[--self.historyIndex];changedPrompt=true}else if(direction==KEY_DOWN){if(self.historyIndex<self.history.length)++self.historyIndex;if(self.historyIndex<self.history.length)prompt.textContent=self.history[self.historyIndex];else prompt.textContent=" ";changedPrompt=true}if(changedPrompt){try{var range=document.createRange();var sel=window.getSelection();range.setStart(prompt.childNodes[0],prompt.textContent.length);range.collapse(true);sel.removeAllRanges();sel.addRange(range)}catch(err){}}};var autoCompleteInput=function(input){var cmds=self.commands,re=new RegExp("^"+input,"ig"),suggestions=[];for(var cmd in cmds){if(cmds.hasOwnProperty(cmd)&&cmd.match(re)){suggestions.push(cmd)}}return suggestions};var saveFilesystem=function(){var strFilesystem;if(typeof XMLSerializer!=="undefined"){strFilesystem=(new XMLSerializer).serializeToString(self.filesystem)}else if("outerHTML"in self.filesystem){strFilesystem=self.filesystem.outerHTML}else{strFilesystem=originalFilesystem}localStorage.setItem("filesystem",strFilesystem)};self.bootTerminalStart=function(terminal){var defaultLine="Type 'help' to get started.";if(typeof bootMessageLines==="undefined"){bootMessageLines=[defaultLine]}if(typeof useBootLoader!=="undefined"&&!useBootLoader){bootMessageLines=[defaultLine]}var boot=document.getElementById("boot");if(boot==null){var bootElement=document.createElement("p");bootElement.setAttribute("id","boot");terminal.insertBefore(bootElement,terminal.firstChild)}boot=document.getElementById("boot");self.bootTerminalMessage(terminal,boot,bootMessageLines,0)};self.bootTerminalMessage=function(terminal,bootElement,introLines,num){if(num==0){terminal.querySelector(".hidden").style.display="none";bootElement.innerHTML=""}bootElement.innerHTML+=introLines[num];if(num+1 in introLines){setTimeout(function(){self.bootTerminalMessage(terminal,bootElement,introLines,num+1)},500)}else{terminal.querySelector(".hidden").style.display="";terminal.querySelector(".input").focus()}};self.catFile=function(path){var foundNode=null;var selector="";if(path.substr(0,1)!="/"){var selector=self.pathMgr.parseFilePathToSelector(self.path+path);var foundNode=self.filesystemPointer.querySelector(selector)}if(typeof foundNode==="undefined"||foundNode==null||foundNode.nodeName!="f"){selector=self.pathMgr.parseFilePathToSelector(path);var foundNode=self.filesystem.querySelector(selector);if(typeof foundNode==="undefined"||foundNode==null||foundNode.nodeName!="f"){return false}}return foundNode.querySelector("contents").innerHTML};self.changeDirectory=function(path){if(path==".."){if(self.filesystemPointer.getAttribute("name")!="/"){self.filesystemPointer=self.filesystemPointer.parentNode.parentNode;self.path=self.filesystemPointer.getAttribute("path");path=self.path;return true}return true}if(path=="."){return true}if(!self.pathMgr.isValidDirectoryPath(path)){return false}var foundNode=self.findDirectory(path);if(foundNode===false){return false}self.path=foundNode.getAttribute("path");if(self.path.substr(-1)!="/")self.path+="/";path=self.path;self.filesystemPointer=foundNode;return true};self.findDirectory=function(path){var foundNode=null;var selector="";if(path.substr(0,1)!="/"){var selector=self.pathMgr.parseDirPathToSelector(self.path+path);var foundNode=self.filesystemPointer.querySelector(selector)}if(typeof foundNode==="undefined"||foundNode==null||foundNode.nodeName!="d"){selector=self.pathMgr.parseDirPathToSelector(path);var foundNode=self.filesystem.querySelector(selector);if(typeof foundNode==="undefined"||foundNode==null||foundNode.nodeName!="d"){return false}}return foundNode};self.deleteFile=function(fileName){if(!self.pathMgr.isValidFilename(fileName)){return"rm: Supplied filename is not valid."}var currentDirChildren=self.filesystemPointer.querySelector("c");var fileFound=currentDirChildren.querySelector("f[path='"+self.path+"'][name='"+fileName+"']");if(fileFound===null){return"rm: No such file."}currentDirChildren.removeChild(fileFound);saveFilesystem();return true};self.makeFile=function(fileName){if(!self.pathMgr.isValidFilename(fileName)){return"touch: Supplied filename is not valid."}var currentDirChildren=self.filesystemPointer.querySelector("c");var fileFound=currentDirChildren.querySelector("f[path='"+self.path+"'][name='"+fileName+"']");if(fileFound!=null){return"touch: File already exists."}var file=document.createElement("f");file.setAttribute("name",fileName);file.setAttribute("path",self.path);file.innerHTML="<contents></contents>";currentDirChildren.appendChild(file);saveFilesystem();return true};self.init=function(elem,commands,customPrompt){self.commands=commands;self.customPrompt=customPrompt;self.initSession();elem.addEventListener("keydown",function(event){if(event.keyCode==KEY_TAB){var prompt=event.target;var suggestions=autoCompleteInput(prompt.textContent.replace(/\s+/g,""));if(suggestions.length==1){prompt.textContent=suggestions[0];var range=document.createRange();var sel=window.getSelection();range.setStart(prompt.childNodes[0],suggestions[0].length);range.collapse(true);sel.removeAllRanges();sel.addRange(range)}event.preventDefault(true);return false}});elem.addEventListener("keyup",function(event){if(self.historyIndex<0)return;browseHistory(event.target,event.keyCode)});elem.addEventListener("keypress",function(event){var prompt=event.target;if(event.keyCode!=13)return false;var enteredComand=prompt.textContent.trim();var input=enteredComand.match(/(?=\S)[^"\s]*(?:"[^\\"]*(?:\\[\s\S][^\\"]*)*"[^"\s]*)*/g);if(input==null){resetPrompt(elem,prompt,false);event.preventDefault();return}input=input.map(function(e){if(e.charAt(0)==='"'&&e.charAt(e.length-1)==='"'){return e.substr(1,e.length-2)}else{return e}});if(input[0]){if(input[0].toLowerCase()in self.commands){runCommand(elem,input[0].toLowerCase(),input);updateHistory(prompt.textContent)}else{elem.innerHTML+=input[0]+": command not found"}}resetPrompt(elem,prompt,["clear","reboot"].indexOf(input[0].toLowerCase())>=0);event.preventDefault()});elem.querySelector(".prompt").innerHTML=self.customPrompt();elem.querySelector(".input").focus();self.term=elem;self.bootTerminalStart(document.getElementById("terminal"));return self};self.initSession=function(){self.history=localStorage.getItem("history")?localStorage.getItem("history").split(","):[];self.historyIndex=self.history.length;var fileSystemStr=localStorage.getItem("filesystem")?localStorage.getItem("filesystem"):originalFilesystem;self.filesystem=(new DOMParser).parseFromString(fileSystemStr,"text/xml");self.path="/";path=self.path;self.filesystemPointer=self.filesystem.querySelector("d")};return self}();function extendObject(n,r){for(var e in r)r.hasOwnProperty(e)&&(n[e]=r[e]);return n}"use strict";function _instanceof(left,right){if(right!=null&&typeof Symbol!=="undefined"&&right[Symbol.hasInstance]){return right[Symbol.hasInstance](left)}else{return left instanceof right}}function _classCallCheck(instance,Constructor){if(!_instanceof(instance,Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}var Tea=function(){function Tea(){_classCallCheck(this,Tea)}_createClass(Tea,null,[{key:"encrypt",value:function encrypt(plaintext,password){plaintext=String(plaintext);password=String(password);if(plaintext.length==0)return"";var v=Tea.strToLongs(Tea.utf8Encode(plaintext));var k=Tea.strToLongs(Tea.utf8Encode(password).slice(0,16));var cipher=Tea.encode(v,k);var ciphertext=Tea.longsToStr(cipher);var cipherbase64=Tea.base64Encode(ciphertext);return cipherbase64}},{key:"decrypt",value:function decrypt(ciphertext,password){ciphertext=String(ciphertext);password=String(password);if(ciphertext.length==0)return"";var v=Tea.strToLongs(Tea.base64Decode(ciphertext));var k=Tea.strToLongs(Tea.utf8Encode(password).slice(0,16));var plain=Tea.decode(v,k);var plaintext=Tea.longsToStr(plain);var plainUnicode=Tea.utf8Decode(plaintext.replace(/\0+$/,""));return plainUnicode}},{key:"encode",value:function encode(v,k){if(v.length<2)v[1]=0;var n=v.length;var delta=2654435769;var q=Math.floor(6+52/n);var z=v[n-1],y=v[0];var mx,e,sum=0;while(q-- >0){sum+=delta;e=sum>>>2&3;for(var p=0;p<n;p++){y=v[(p+1)%n];mx=(z>>>5^y<<2)+(y>>>3^z<<4)^(sum^y)+(k[p&3^e]^z);z=v[p]+=mx}}return v}},{key:"decode",value:function decode(v,k){var n=v.length;var delta=2654435769;var q=Math.floor(6+52/n);var z=v[n-1],y=v[0];var mx,e,sum=q*delta;while(sum!=0){e=sum>>>2&3;for(var p=n-1;p>=0;p--){z=v[p>0?p-1:n-1];mx=(z>>>5^y<<2)+(y>>>3^z<<4)^(sum^y)+(k[p&3^e]^z);y=v[p]-=mx}sum-=delta}return v}},{key:"strToLongs",value:function strToLongs(s){var l=new Array(Math.ceil(s.length/4));for(var i=0;i<l.length;i++){l[i]=s.charCodeAt(i*4)+(s.charCodeAt(i*4+1)<<8)+(s.charCodeAt(i*4+2)<<16)+(s.charCodeAt(i*4+3)<<24)}return l}},{key:"longsToStr",value:function longsToStr(l){var str="";for(var i=0;i<l.length;i++){str+=String.fromCharCode(l[i]&255,l[i]>>>8&255,l[i]>>>16&255,l[i]>>>24&255)}return str}},{key:"utf8Encode",value:function utf8Encode(str){return unescape(encodeURIComponent(str))}},{key:"utf8Decode",value:function utf8Decode(utf8Str){try{return decodeURIComponent(escape(utf8Str))}catch(e){return utf8Str}}},{key:"base64Encode",value:function base64Encode(str){if(typeof btoa!="undefined")return btoa(str);if(typeof Buffer!="undefined")return new Buffer(str,"binary").toString("base64");throw new Error("No Base64 Encode")}},{key:"base64Decode",value:function base64Decode(b64Str){if(typeof atob=="undefined"&&typeof Buffer=="undefined")throw new Error("No base64 decode");try{if(typeof atob!="undefined")return atob(b64Str);if(typeof Buffer!="undefined")return new Buffer(b64Str,"base64").toString("binary")}catch(e){throw new Error("Invalid ciphertext")}}}]);return Tea}();